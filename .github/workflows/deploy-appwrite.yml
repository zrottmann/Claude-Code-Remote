name: Deploy Claude Code Remote to Appwrite

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci --legacy-peer-deps
    
    - name: Build application
      run: npm run build
      env:
        NEXT_PUBLIC_APPWRITE_PROJECT_ID: 68a9a5e4003518a2495b
        NEXT_PUBLIC_APPWRITE_PROJECT_NAME: remote
        NEXT_PUBLIC_APPWRITE_ENDPOINT: https://nyc.cloud.appwrite.io/v1
    
    - name: Create deployment package
      run: |
        mkdir -p deploy
        cp -r out/* deploy/ || cp -r .next/static deploy/_next/
        cp -r public/* deploy/ || true
        echo '{"name": "claude-code-remote", "version": "1.0.0", "scripts": {"build": "echo ready"}}' > deploy/package.json
        cd deploy && tar -czf ../claude-remote.tar.gz .
    
    - name: Deploy to Appwrite Sites
      env:
        APPWRITE_API_KEY: ${{ secrets.APPWRITE_API_KEY }}
      run: |
        echo "Deployment package ready: claude-remote.tar.gz"
        echo "Upload to Appwrite Console or use Appwrite CLI"
        
    - name: Upload deployment artifact
      uses: actions/upload-artifact@v3
      with:
        name: claude-remote-deployment
        path: claude-remote.tar.gz
